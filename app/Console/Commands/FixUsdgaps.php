<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;

class FixUsdgaps extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'fix:usdgaps';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return mixed
     */
    
    public function handle()
    {

$curl = curl_init();

curl_setopt_array($curl, array(
  CURLOPT_URL => 'https://affiliates.bybit.com/api/commissions?coin=ETH&page=11&page_size=100&start_date=2021-01-01',
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => '',
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 0,
  CURLOPT_FOLLOWLOCATION => true,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => 'POST',
  CURLOPT_HTTPHEADER => array(
    'accept:  application/json, text/plain, */*',
    'accept-encoding:  gzip, deflate, br',
    'accept-language:  en-GB,en-US;q=0.9,en;q=0.8',
    'authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwczpcL1wvYWZmaWxpYXRlcy5ieWJpdC5jb21cL2FwaVwvbG9naW4iLCJpYXQiOjE2Mzk0MzYwOTUsImV4cCI6MTYzOTQzNzg5NSwibmJmIjoxNjM5NDM2MDk1LCJqdGkiOiJsWXY4RnlxcHRmc09xVzhRIiwic3ViIjoxMDYyMCwicHJ2IjoiYTI5MDM0ZTM1ZWY2ZjVlMGE5OGM0NmE3YmMzZmE4MGIwNzhiMTYxNSJ9.teAlzpj5e7mXvE_ImQDUZ1EyoBNr1R2E_9rMO6e56Ko',
    'content-length:  113',
    'content-type:  application/json;charset=UTF-8',
    'cookie:  _by_l_g_d=78fa4424-caa5-4c08-a0f5-eac6155fcd1e; _fbp=fb.1.1612187008709.1298812133; __zlcmid=12RjmLQeXqjy8b3; _scid=765bb2a2-5ab8-46c3-83af-8163ad2659b2; __uuid=BH-0520750e50e0-f8b9-9489-5119-0890aa0b30a6; _ym_uid=1626510191164203974; _ym_d=1626510191; _by_l_g_d=78fa4424-caa5-4c08-a0f5-eac6155fcd1e; _uetvid=765d2d60649311ebbf67b32b7dff36f5; _ga_LEBL6PF94W=GS1.1.1635609025.2.0.1635609025.0; _gcl_au=1.1.2137777667.1635708374; BYBIT_REG_REF_testnet={"lang":"en-GB","g":"78fa4424-caa5-4c08-a0f5-eac6155fcd1e","medium":"direct","url":"https://testnet.bybit.com/en-US/"}; _rdt_uuid=1637834086634.b5b82b67-53be-4e1d-a755-a88118829aa1; BYBIT_REG_REF_prod={"lang":"en-GB","g":"78fa4424-caa5-4c08-a0f5-eac6155fcd1e","referrer":"www.winrate.io/","source":"winrate.io","medium":"affiliate","affiliate_id":"10620","group_id":"24810","group_type":"1","url":"https://www.bybit.com/register?affiliate_id=10620&group_id=24810&group_type=1"}; 35CJa4376-ref=referral|others|winrate.io|winrate.io|1638883812647; 35CJa4376=660c4a7cda-1638883812648; 35CJa4376-cp=660c4a7cda-1638883812648; _gid=GA1.2.1733593374.1639243628; _ym_isad=2; b_t_c_k=eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2Mzk2NjI4MDcsInVzZXJfaWQiOjEzODM0ODYsIm5vbmNlIjoiMjU1Njg0YWIifQ.Rlt8561jaqAcT1AWx_7HxZYHgNzPCdjYI-sqGg0jz3ACh9tPuFiQDb6EoaFO2QI6gENrOODKL2xyZBomNzrwFg; sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%221383486%22%2C%22first_id%22%3A%2217cd19b7798fb7-0fd8f349acb4148-1f3d6851-1764000-17cd19b779915f8%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22%E7%9B%B4%E6%8E%A5%E6%B5%81%E9%87%8F%22%2C%22%24latest_search_keyword%22%3A%22%E6%9C%AA%E5%8F%96%E5%88%B0%E5%80%BC_%E7%9B%B4%E6%8E%A5%E6%89%93%E5%BC%80%22%2C%22%24latest_referrer%22%3A%22%22%7D%2C%22%24device_id%22%3A%2217cd19b7798fb7-0fd8f349acb4148-1f3d6851-1764000-17cd19b779915f8%22%2C%22identities%22%3A%22%5Cn%2F1vqr%7B%5Cu0003v%5Cu0003%5Cblp%7C%7Cxvrlvq%2FG%2F%3EDqnrrCCBqoBn%3E%3A%3DAn%3D%3FC%40AsAo%3EAAp%3A%3E%40%40sCAB%3F%3A%3F%40%3DA%3D%3D%3D%3A%3EDqnrrCCBqp%3EorC%2F9%2F1vqr%7B%5Cu0003v%5Cu0003%5Cbly%7Ctv%7Blvq%2FG%2F%3E%40E%40AEC%2F%5Cf%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%24identity_login_id%22%2C%22value%22%3A%221383486%22%7D%7D; RT="z=1&dm=bybit.com&si=089bcec5-179a-4129-8fb4-57daf6df38d4&ss=kx4qe667&sl=9&tt=8hw&obo=3&rl=1"; _ga_T6K14VPPVK=GS1.1.1639403295.697.1.1639405837.0; _ga=GA1.2.600454883.1612187007; _abck=BC473D2181AFC501EA0FE8D45A6A2067~0~YAAQ1FzaF+7YWLJ9AQAAovkotQeAh4ANZXq1MgI7IFPyTCOYmjCItgIbt9p2dD7xHw1Qfj7bZ7zW3xRVpd2gaHQS1nVf3m6FsHwhHO11e6EUGkK94sJZgpUyqgH34HkyHfXSBQxOSZBqtRGTwqSDJY0XLUYHyCvBwk4s7kntSk5Rru/pWuv83Lx5JnlHBgHr2hbsOkP0lEaVbCQW9vaQeHDYnXDOdyhq4WLMcC6hVfxExkvGEE8MXcQJsqw3N1EI8BhpZC+lEJFciEBxJzQ/skc2tXhc4cvFYOUdfj0M5Wev7tJja8LePTuSsCxHNcjt8K/WRBMI0ulM8b7LJ5/qzp9PXll5/hiVm9a+U7tggYfMdKmWWXx6mYYZdOjcloQCyNTWMhI+0NbMSbkgU99OsiOP/Lh0DYQ=~-1~-1~-1; ak_bmsc=DCFCE53B69BA2BDD2515EC68BBB1A260~000000000000000000000000000000~YAAQz1zaFw9Tu559AQAA+ZCotQ6JVhfEb1s/aNrN06fNJAKabqAZyyC1k7IW9k7InW40aqKY3klJ3+WmvuM1Z0q+WSIib8u57ZT2Q7VJ6p7qAv14i6VsGh6ZBfui52XdGctOyugOKnWy+LMRQ93wOJxmphgnYeXzSMgZySeodwI4dkMu5zWeacU55u3JrLx997QL3c/JVpzJLvGh+Zv0TK/bHbk3dKZ9YdIOkFFxYXp3IFmhRN85Uwy1q6QUmLcRbNz/tKluzVBqBM8WUkUBTeVQwCDlmvc6NvggnkfpogOoc+r/cSgZJv8ZEUTBHvT9ryHyjxmmcQBj6wCH+OPCl4c/oMVeA+i5R0k+ed7zy7d/SiPQuB7vDARgH0CD8XP3urO+affHW7W1; bm_mi=0F6384886ED96377BD9A94AC3DA22C15~56YOh0moG0BykKzT5KhACSFG5EeBaWBEGDjbjKefeTvYTGUy69VKU68331d/dro9u/3eO2q/KOGoysBGvuJTX6B8NdxWx+P8RPb2jq0Yv4UQODluTV+u+GYeXsVbUIPyZXtisA/K45ifNkxaqmLahXK6NnCLokspXvNlcH2IFxwuhRMoNhgAeWlzTSnSnh7vrQU11I21k1WDy/JZB32xh41gNpvCHuWa0lGjKMa4JVE=; bm_sz=14F9853C9963372A4C367E3A0B5E01BC~YAAQz1zaF7Rhu559AQAArI3vtQ4TeIAO55U0pSW5P7BcIb5h7b32ANZb4V44/CH6P6HDgMsRBoktUH1dYuow3lLI2WKsYGlKwCoGrrgl0kvjDBkqL0ncSWyYy9oYnDDHIL/yrf8u4noVw7k7iMcHqQ8WEcSjOhZwlzucex2PFxsahM07wNLKEBOvehvEhGccyQlTwKcXCiFW0dwrM6nu9EdQLHUt5scK9Dxh9F/zuaAXLXvSkLlKgbVxTNFy2/0RymVDq0S4G3og1kPNvDFRtQQ3T75xzY9QdBhaAcMVjuvqqOuGWS2vIM99zcziWjIxCxugsLRDx29ALQ==~3422259~4539444; bm_sv=D7D5B0E88DB62BB9EBAC53C775EDDA18~FGHLBPZmu5wGLV5g9cCbB8zb5VvG02P9Qki7OpJwLDIcU87WtPWKEPNPyaNaeq5JcuHVYal00chE3rSPDAvm7FLbl8sT/jakO9TTafl8JrYBxmhIif+u65H96GIH3G015N1UEBVcleTZGJJFu6lQ25LAykeNT/gMw+KbhuKP2OI=; _abck=BC473D2181AFC501EA0FE8D45A6A2067~-1~YAAQGWvcF0i+37N9AQAACbUItgexUC3fzxU/8mLXb0wgWJsaDS25sWY/dbrgOixoDDdi3lRrg/3VY2PzndeentP2sAWMab0my6o+h5a+uFdzvNQLk56DegmkStpSbCvtDNYdq5CpLb6Rfbc7mkZ/kknBUppla/ipw68cFsPVbhJ0kUX1U12C+cYbZY/9cgp2fDxwGh+v88PEhf1123yYj8BkW19I4X36jv/BlCKX3I1RYVCT7oFTiAOwQqJ09KlrkVgUfn8kyucu0dE0IOsC2xEPzbepKfZ4oDRCaIDr2uoJlfbkFZjd8lviQ59mfJ4aT5ZECEks2GoL7os12UDPGtgOaO3YFWqCOyBJe/8JkhSdSE7sorJkFDB56oAj~0~-1~-1; bm_sv=D7D5B0E88DB62BB9EBAC53C775EDDA18~FGHLBPZmu5wGLV5g9cCbB8zb5VvG02P9Qki7OpJwLDIcU87WtPWKEPNPyaNaeq5JcuHVYal00chE3rSPDAvm7FLbl8sT/jakO9TTafl8JrYmvsLjtwVqoQHUDX8YM2Lur0YDYIbf6pMs7kY+shakBNZlLE+8dbJS2h9+obpNoa0=',
    'origin:  https://affiliates.bybit.com',
    'referer:  https://affiliates.bybit.com/v2/affiliate-portal/commissions/contract',
    'sec-ch-ua:  " Not A;Brand";v="99", "Chromium";v="96", "Google Chrome";v="96"',
    'sec-ch-ua-mobile:  ?0',
    'sec-ch-ua-platform:  "macOS"',
    'sec-fetch-dest:  empty',
    'sec-fetch-mode:  cors',
    'sec-fetch-site:  same-origin',
    'user-agent:  Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36'
  ),
));

$response = curl_exec($curl);

curl_close($curl);
echo $response;

    }

    public function handle_correct_use_this_one()
    {
        $dates = [
            '2021-01-04',
            '2021-01-05',
            '2021-01-06',
            '2021-01-07',
            '2021-01-08',
            '2021-01-09',
            '2021-01-10',
            '2021-01-11',
            '2021-01-12',
            '2021-01-13',
            '2021-01-14',
            '2021-01-15',
            '2021-01-16',
            '2021-01-17',
            '2021-01-18',
            '2021-01-19',
            '2021-01-20',
            '2021-01-21',
            '2021-01-22',
            '2021-01-23',
            '2021-01-24',
            '2021-01-25',
            '2021-01-26',
            '2021-01-27',
            '2021-01-28',
            '2021-01-29',
            '2021-01-30',
            '2021-01-31',
            '2021-02-01',
            '2021-02-02',
            '2021-02-03',
            '2021-02-04',
            '2021-02-05',
            '2021-02-06',
            '2021-02-07',
            '2021-02-08',
            '2021-02-09',
            '2021-02-10',
            '2021-02-11',
            '2021-02-12',
            '2021-02-13',
            '2021-02-14',
            '2021-02-15',
            '2021-02-16',
            '2021-02-17',
            '2021-02-18',
            '2021-02-19',
            '2021-02-20',
            '2021-02-21',
            '2021-02-22',
            '2021-02-23',
            '2021-02-24',
            '2021-02-25',
            '2021-02-26',
            '2021-02-27',
            '2021-02-28',
            '2021-03-01',
            '2021-03-02',
            '2021-03-03',
            '2021-03-04',
            '2021-03-05',
            '2021-03-06',
            '2021-03-07',
            '2021-03-08',
            '2021-03-09',
            '2021-03-10',
            '2021-03-11',
            '2021-03-12',
            '2021-03-13',
            '2021-03-14',
            '2021-03-15',
            '2021-03-16',
            '2021-03-17',
            '2021-03-18',
            '2021-03-19',
            '2021-03-20',
            '2021-03-21',
            '2021-03-22',
            '2021-03-23',
            '2021-03-24',
            '2021-03-25',
            '2021-03-26',
            '2021-03-27',
            '2021-03-28',
            '2021-03-29',
            '2021-03-30',
            '2021-03-31',
            '2021-04-01',
            '2021-04-02',
            '2021-04-03',
            '2021-04-04',
            '2021-04-05',
            '2021-04-06',
            '2021-04-07',
            '2021-04-08',
            '2021-04-09',
            '2021-04-10',
            '2021-04-11',
            '2021-04-12',
            '2021-04-13',
            '2021-04-14',
            '2021-04-15',
            '2021-04-16',
            '2021-04-17',
            '2021-04-18',
            '2021-04-19',
            '2021-04-20',
            '2021-04-21',
            '2021-04-22',
            '2021-04-23',
            '2021-04-24',
            '2021-04-25',
            '2021-04-26',
            '2021-04-27',
            '2021-04-28',
            '2021-04-29',
            '2021-04-30',
            '2021-05-01',
            '2021-05-02',
            '2021-05-03',
            '2021-05-04',
            '2021-05-05',
            '2021-05-06',
            '2021-05-07',
            '2021-05-08',
            '2021-05-09',
            '2021-05-10',
            '2021-05-11',
            '2021-05-12',
            '2021-05-13',
            '2021-05-14',
            '2021-05-15',
            '2021-05-16',
            '2021-05-17',
            '2021-05-18',
            '2021-05-19',
            '2021-05-20',
            '2021-05-21',
            '2021-05-22',
            '2021-05-23',
            '2021-05-24',
            '2021-05-25',
            '2021-05-26',
            '2021-05-27',
            '2021-05-28',
            '2021-05-29',
            '2021-05-30',
            '2021-05-31',
            '2021-06-01',
            '2021-06-02',
            '2021-06-03',
            '2021-06-04',
            '2021-06-05',
            '2021-06-06',
            '2021-06-07',
            '2021-06-08',
            '2021-06-09',
            '2021-06-10',
            '2021-06-11',
            '2021-06-12',
            '2021-06-13',
            '2021-06-14',
            '2021-06-15',
            '2021-06-16',
            '2021-06-17',
            '2021-06-18',
            '2021-06-19',
            '2021-06-20',
            '2021-06-21',
            '2021-06-22',
            '2021-06-23',
            '2021-06-24',
            '2021-06-25',
            '2021-06-26',
            '2021-06-27',
            '2021-06-28',
            '2021-06-29',
            '2021-06-30',
            '2021-07-01',
            '2021-07-02',
            '2021-07-03',
            '2021-07-04',
            '2021-07-05',
            '2021-07-06',
            '2021-07-07',
            '2021-07-08',
            '2021-07-09',
            '2021-07-10',
            '2021-07-11',
            '2021-07-12',
            '2021-07-13',
            '2021-07-14',
            '2021-07-15',
            '2021-07-16',
            '2021-07-17',
            '2021-07-18',
            '2021-07-19',
            '2021-07-20',
            '2021-07-21',
            '2021-07-22',
            '2021-07-23',
            '2021-07-24',
            '2021-07-25',
            '2021-07-26',
            '2021-07-27',
            '2021-07-28',
            '2021-07-29',
            '2021-07-30',
            '2021-07-31',
            '2021-08-01',
            '2021-08-02',
            '2021-08-03',
            '2021-08-04',
            '2021-08-05',
            '2021-08-06',
            '2021-08-07',
            '2021-08-08',
            '2021-08-09',
            '2021-08-10',
            '2021-08-11',
            '2021-08-12',
            '2021-08-13',
            '2021-08-14',
            '2021-08-15',
            '2021-08-16',
            '2021-08-17',
            '2021-08-18',
            '2021-08-19',
            '2021-08-20',
            '2021-08-21',
            '2021-08-22',
            '2021-08-23',
            '2021-08-24',
            '2021-08-25',
            '2021-08-26',
            '2021-08-27',
            '2021-08-28',
            '2021-08-29',
            '2021-08-30',
            '2021-08-31',
            '2021-09-01',
            '2021-09-02',
            '2021-09-03',
            '2021-09-04',
            '2021-09-05',
            '2021-09-06',
            '2021-09-07',
            '2021-09-08',
            '2021-09-09',
            '2021-09-10',
            '2021-09-11',
            '2021-09-12',
            '2021-09-13',
            '2021-09-14',
            '2021-09-15',
            '2021-09-16',
            '2021-09-17',
            '2021-09-18',
            '2021-09-19',
            '2021-09-20',
            '2021-09-21',
            '2021-09-22',
            '2021-09-23',
            '2021-09-24',
            '2021-09-25',
            '2021-09-26',
            '2021-09-27',
            '2021-09-28',
            '2021-09-29',
            '2021-09-30',
            '2021-10-01',
            '2021-10-02',
            '2021-10-03',
            '2021-10-04',
            '2021-10-05',
            '2021-10-06',
            '2021-10-07',
            '2021-10-08',
            '2021-10-09',
            '2021-10-10',
            '2021-10-11',
            '2021-10-12',
            '2021-10-13',
            '2021-10-14',
            '2021-10-15',
            '2021-10-16',
            '2021-10-17',
            '2021-10-18',
            '2021-10-19',
            '2021-10-20',
            '2021-10-21',
            '2021-10-22',
            '2021-10-23',
            '2021-10-24',
            '2021-10-25',
            '2021-10-26',
            '2021-10-27',
            '2021-10-28',
            '2021-10-29',
            '2021-10-30',
            '2021-10-31',
            '2021-11-01',
            '2021-11-02',
            '2021-11-03',
            '2021-11-04',
            '2021-11-05',
            '2021-11-06',
            '2021-11-07',
            '2021-11-08',
            '2021-11-09',
            '2021-11-10',
            '2021-11-11',
            '2021-11-12',
            '2021-11-13',
            '2021-11-14',
            '2021-11-15',
            '2021-11-16',
            '2021-11-17',
            '2021-11-18',
            '2021-11-19',
            '2021-11-20',
            '2021-11-21',
            '2021-11-22',
            '2021-11-23',
            '2021-11-24',
            '2021-11-25',
            '2021-11-26',
            '2021-11-27',
            '2021-11-28',
            '2021-11-29',
            '2021-11-30',
            '2021-12-01',
            '2021-12-02',
            '2021-12-03',
            '2021-12-04',
            '2021-12-05',
            '2021-12-06',
            '2021-12-07',
            '2021-12-08',
            '2021-12-09',
            '2021-12-10',
        ];

        foreach ($dates as $key => $date) {
            $usdprice = \App\Usdsekprice::where('date', $date)->first();

            if (isset($usdprice->price)) {
                $this->lastPrice = $usdprice->price;
            } else {
                $newprice = new \App\Usdsekprice;

                $newprice->date = $date;
                $newprice->price = $this->lastPrice;

                $newprice->save();
            }
        }

    }
}
